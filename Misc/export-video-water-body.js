/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var l8 = ee.ImageCollection("LANDSAT/LC8_L1T_TOA"),
    l7 = ee.ImageCollection("LANDSAT/LE7_L1T_TOA"),
    l5 = ee.ImageCollection("LANDSAT/LT5_L1T_TOA"),
    l4 = ee.ImageCollection("LANDSAT/LT4_L1T_TOA"),
    l2 = ee.ImageCollection("LANDSAT/LM2_L1T"),
    area = /* color: #d63000 */ee.Geometry.Polygon(
        [[[96.04316711425781, 22.073709495603147],
          [96.04402542114258, 22.077209185816983],
          [96.04402542114258, 22.079595288527113],
          [96.04299545288086, 22.082458558572245],
          [96.0421371459961, 22.08468550625235],
          [96.04162216186523, 22.088184924507612],
          [96.04162216186523, 22.09550160966498],
          [96.04162216186523, 22.100591253903087],
          [96.04093551635742, 22.104885498431994],
          [96.04059219360352, 22.108543455483815],
          [96.04179382324219, 22.112996492545076],
          [96.04162216186523, 22.11808550556902],
          [96.04127883911133, 22.122061169176842],
          [96.04059219360352, 22.12603672064691],
          [96.03939056396484, 22.130330190263024],
          [96.03836059570312, 22.134146497862382],
          [96.03767395019531, 22.13684965319099],
          [96.03784561157227, 22.14034777719162],
          [96.03836059570312, 22.143209814013495],
          [96.04042053222656, 22.14543580243242],
          [95.99184036254883, 22.14559480025845],
          [95.99081039428711, 22.14002976950943],
          [95.99166870117188, 22.134782539077413],
          [95.9926986694336, 22.12953511316752],
          [95.9930419921875, 22.126354759919685],
          [95.99510192871094, 22.12285628844239],
          [95.99613189697266, 22.119834811370797],
          [95.99578857421875, 22.114904893954304],
          [95.99750518798828, 22.110610954462928],
          [95.99956512451172, 22.106794009598627],
          [96.00059509277344, 22.104249322305115],
          [96.00042343139648, 22.100591253903087],
          [96.00059509277344, 22.09677403793378],
          [96.00385665893555, 22.094706336171342],
          [96.00557327270508, 22.091048020385887],
          [96.00797653198242, 22.087071482652174],
          [96.00883483886719, 22.083731104403892],
          [96.01226806640625, 22.077686409583496],
          [96.01278305053711, 22.074982120257058],
          [96.01381301879883, 22.071959617987233],
          [96.01638793945312, 22.069096135144505],
          [96.0175895690918, 22.06495989082864],
          [96.01879119873047, 22.060823525473037],
          [96.01947784423828, 22.057641623615734],
          [96.0205078125, 22.051118500970574],
          [96.02033615112305, 22.047777272862042],
          [96.0208511352539, 22.043799517460943],
          [96.02222442626953, 22.04204926965805],
          [96.02256774902344, 22.036798396369658],
          [96.02153778076172, 22.031706454427077],
          [96.01982116699219, 22.02645519749487],
          [96.01879119873047, 22.021840295807863],
          [96.01638793945312, 22.017225243771193],
          [96.01364135742188, 22.011496004527803],
          [96.01312637329102, 22.005129911512014],
          [96.0124397277832, 21.996216901047774],
          [96.01175308227539, 21.991441843595673],
          [96.01192474365234, 21.985552384726205],
          [96.01312637329102, 21.980617785057056],
          [96.01518630981445, 21.97647895628412],
          [96.01673126220703, 21.973931924760475],
          [96.01861953735352, 21.970111291812888],
          [96.01947784423828, 21.96756414607923],
          [96.01879119873047, 21.96390254406486],
          [96.01673126220703, 21.961036876657936],
          [96.0153579711914, 21.958330359927047],
          [96.01346969604492, 21.95466851995024],
          [96.01226806640625, 21.95180266633386],
          [96.01158142089844, 21.949414410851833],
          [96.009521484375, 21.946707672806205],
          [96.00866317749023, 21.94288630784811],
          [96.00866317749023, 21.9395425292792],
          [96.00797653198242, 21.935084035580864],
          [96.00677490234375, 21.931262358347166],
          [96.0069465637207, 21.927122092187922],
          [96.00625991821289, 21.923777943135143],
          [96.00505828857422, 21.919637459274274],
          [96.00385665893555, 21.91581536730296],
          [96.00162506103516, 21.912311692882273],
          [96.00128173828125, 21.90848940431265],
          [96.00128173828125, 21.9033928600299],
          [96.00093841552734, 21.89813685782396],
          [95.99905014038086, 21.89303994331778],
          [95.99681854248047, 21.886987120681585],
          [95.99527359008789, 21.88252698172221],
          [95.9933853149414, 21.879500379434862],
          [95.99081039428711, 21.876473712942143],
          [95.9872055053711, 21.87265046350536],
          [95.98257064819336, 21.87121671856104],
          [95.97742080688477, 21.87010157364748],
          [95.9714126586914, 21.869623651731885],
          [95.96609115600586, 21.868667803100408],
          [95.96231460571289, 21.866756086636983],
          [95.95270156860352, 21.863251206635443],
          [95.94480514526367, 21.861658050921537],
          [95.93793869018555, 21.859746240603453],
          [95.9329605102539, 21.858790325847092],
          [95.92884063720703, 21.86006487743378],
          [95.92660903930664, 21.86181736729277],
          [95.92042922973633, 21.868827111650123],
          [95.91682434082031, 21.8694643440711],
          [95.91253280639648, 21.872013245308164],
          [95.9109878540039, 21.8732876788576],
          [95.9077262878418, 21.878863191824415],
          [95.9054946899414, 21.882208395031483],
          [95.9025764465332, 21.886190677524734],
          [95.89948654174805, 21.890013564114664],
          [95.89399337768555, 21.895269865836923],
          [95.89244842529297, 21.897340476944823],
          [95.89176177978516, 21.899729606233986],
          [95.89004516601562, 21.90307431995957],
          [95.88987350463867, 21.906100421878413],
          [95.88970184326172, 21.910878346687404],
          [95.8890151977539, 21.912789471742055],
          [95.88850021362305, 21.9156561112446],
          [95.88781356811523, 21.91868194589906],
          [95.88695526123047, 21.92107071731432],
          [95.88455200195312, 21.922503960926353],
          [95.88111877441406, 21.922503960926353],
          [95.8773422241211, 21.921866965546734],
          [95.87373733520508, 21.921389217141666],
          [95.87013244628906, 21.919637459274274],
          [95.86515426635742, 21.919955962307785],
          [95.85948944091797, 21.92011521355736],
          [95.855712890625, 21.91884119857354],
          [95.85142135620117, 21.91677089991318],
          [95.84352493286133, 21.913107990091564],
          [95.84352493286133, 21.899411057975826],
          [95.8476448059082, 21.8995703321939],
          [95.85622787475586, 21.898933234253736],
          [95.86326599121094, 21.89797758200408],
          [95.86790084838867, 21.896862646281697],
          [95.8747673034668, 21.894154908937097],
          [95.87871551513672, 21.89128783687129],
          [95.88489532470703, 21.88650925532116],
          [95.88987350463867, 21.88141192519194],
          [95.89313507080078, 21.876473712942143],
          [95.8967399597168, 21.871376024266063],
          [95.89897155761719, 21.865162970029186],
          [95.90326309204102, 21.858949645417464],
          [95.90755462646484, 21.855285250337715],
          [95.91270446777344, 21.85178008882291],
          [95.91682434082031, 21.849390156666583],
          [95.92266082763672, 21.84747818216061],
          [95.92609405517578, 21.846362851885193],
          [95.92901229858398, 21.84476950782104],
          [95.93158721923828, 21.84413216522173],
          [95.93605041503906, 21.84508817805494],
          [95.94205856323242, 21.847637514346523],
          [95.94995498657227, 21.85178008882291],
          [95.95596313476562, 21.854488630272456],
          [95.9597396850586, 21.85640051096578],
          [95.96471786499023, 21.85783440469281],
          [95.96832275390625, 21.858471686173196],
          [95.97295761108398, 21.859427603062226],
          [95.97810745239258, 21.86054283134629],
          [95.9823989868164, 21.860383513553188],
          [95.9872055053711, 21.861658050921537],
          [95.9930419921875, 21.864207091531906],
          [95.99664688110352, 21.868349185467633],
          [95.99870681762695, 21.87121671856104],
          [96.00128173828125, 21.876314412927286],
          [96.00454330444336, 21.879341082799026],
          [96.0069465637207, 21.88141192519194],
          [96.00900650024414, 21.883482737525377],
          [96.01055145263672, 21.88666854395254],
          [96.01278305053711, 21.89049141773285],
          [96.0153579711914, 21.89335850581302],
          [96.01810455322266, 21.89495130761246],
          [96.02239608764648, 21.896384814016866],
          [96.02514266967773, 21.897818306006226],
          [96.02806091308594, 21.900685246736767],
          [96.03046417236328, 21.90387066880032],
          [96.03200912475586, 21.90721528533268],
          [96.03355407714844, 21.910719085108788],
          [96.03544235229492, 21.91470057115464],
          [96.03578567504883, 21.919478207490346],
          [96.03561401367188, 21.924255683524144],
          [96.03939056396484, 21.928077548915102],
          [96.04368209838867, 21.930943880611242],
          [96.04677200317383, 21.93189931168076],
          [96.04900360107422, 21.934765566398568],
          [96.04969024658203, 21.93938329976756],
          [96.04986190795898, 21.94304553343818],
          [96.04951858520508, 21.947981438305234],
          [96.05020523071289, 21.951961881939454],
          [96.0505485534668, 21.955305368462646],
          [96.05226516723633, 21.958648776335657],
          [96.05295181274414, 21.961832901179765],
          [96.05587005615234, 21.966290556083404],
          [96.05621337890625, 21.96947450966188],
          [96.05758666992188, 21.975205446233463],
          [96.06033325195312, 21.986029917524586],
          [96.06101989746094, 21.991441843595673],
          [96.05947494506836, 21.995261902416345],
          [96.05810165405273, 22.000036831271867],
          [96.05621337890625, 22.004970755523694],
          [96.05432510375977, 22.01229174605147],
          [96.0531234741211, 22.01642952995016],
          [96.0483169555664, 22.022635979239702],
          [96.04471206665039, 22.025341269475348],
          [96.04248046875, 22.028364768001538],
          [96.0399055480957, 22.032979457082526],
          [96.03561401367188, 22.041094579914038],
          [96.03647232055664, 22.046027074263158],
          [96.03527069091797, 22.048095488462913],
          [96.03630065917969, 22.051118500970574],
          [96.03647232055664, 22.05445965015614],
          [96.03544235229492, 22.05732342949174],
          [96.03630065917969, 22.060505338509657],
          [96.03939056396484, 22.066073506975297],
          [96.04248046875, 22.071005130153544]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// center map to study area
// Map.setCenter(96.0, 21.95,12)
print(Map.getCenter())
var bounds = ee.Geometry(Map.getBounds(true)).buffer(-100);

var VIS_IMAGE = {min:0.03, max:[0.4,0.4,0.5]}

// Bands and names
var L8_BANDS = ['B6', 'B5', 'B3', 'B4', 'B2']
var L7_BANDS = ['B5', 'B4', 'B2', 'B3', 'B1']
var S2_BANDS = ['B11', 'B8', 'B3', 'B4', 'B2']
var NAMES =    ['swir1', 'nir', 'green', 'red', 'blue']

// Create imageCollection all satellites
var imagesl8 = l8.filterBounds(bounds.centroid()).select(L8_BANDS, NAMES)
var imagesl7 = l7.filterBounds(bounds.centroid()).select(L7_BANDS, NAMES)
var imagesl5 = l5.filterBounds(bounds.centroid()).select(L7_BANDS, NAMES)
var imagesl4 = l4.filterBounds(bounds.centroid()).select(L7_BANDS, NAMES)

var images = ee.ImageCollection(imagesl8.merge(imagesl7).merge(imagesl5).merge(imagesl4))

var years = ee.List.sequence(2010, 2016)

var frames = ee.ImageCollection(years
  .map(function(y) {
    var start = ee.Date.fromYMD(y, 1, 1)
    var end = start.advance(3, 'month');

    var image = images.filterDate(start, end).reduce(ee.Reducer.percentile([20])).rename(NAMES)
    
    return image.visualize({bands: ['swir1', 'nir', 'green'], min: 0.03, max:0.3})
      .paint(area,255,5)
      .set('year', y)
}))

//box for figures
var box = ee.Geometry.Polygon([[95.92025, 22.08023], [95.92025,21.83919], [96.11835,21.83919], [96.11835,22.08023]])
Map.addLayer(ee.Image().paint(box, 255, 2),{},'box')
Map.centerObject(box, 12)
//var collection = collection_old.cast(frames)
// print('collection 2', collection)
// Export (change dimensions or scale for higher quality).
// Export.video.toDrive({
//   collection: frames,
//   description: 'Mandalay',
//   dimensions: 2840,
//   framesPerSecond: 1,
//   region: box
// });

Export.video.toDrive({
    collection: frames,
    description: 'Mandalay',
    dimensions: 1420,
    region: box,
    framesPerSecond: 2,
    crs: 'EPSG: 4326'
})
